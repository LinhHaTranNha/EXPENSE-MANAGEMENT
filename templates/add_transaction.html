<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="../static/image/money.jpg">
    <title>Th√™m Giao D·ªãch - FinMan</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="../static/css/animate.css">
    <link rel="stylesheet" href="../static/css/style.css">

    <style>
        /* üìå To√†n trang */
        body {
            background-color: #001307;
            color: #e0e0e0;
            font-family: "Poppins", sans-serif;
        }

        /* üìå H·ªôp ch·ª©a form */
        .transaction-container {
            background: #1a3323;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            max-width: 500px;
            width: 100%;
            text-align: center;
            backdrop-filter: blur(10px);
            animation: fadeIn 0.8s ease-in-out;
            margin: auto;
        }

        /* üìå Ti√™u ƒë·ªÅ */
        .transaction-container h2 {
            color: #00ff99;
            font-size: 24px;
            margin-bottom: 10px;
        }

        /* üìå M√¥ t·∫£ */
        .transaction-container p {
            font-size: 14px;
            color: #bdc3c7;
            margin-bottom: 20px;
        }

        /* üìå N√∫t Back to Dashboard */
        .back-dashboard-container {
            text-align: left;
            margin-bottom: 15px;
            display: flex;
            justify-content: center;
        }

        .back-dashboard-btn {
            background: linear-gradient(135deg, #081c12, #0f2a1b);
            color: #00ff99;
            font-weight: bold;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 8px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: 0.3s;
            border: none;
        }

        .back-dashboard-btn:hover {
            background: linear-gradient(135deg, #0f2a1b, #00ff99);
            color: #fff;
            transform: translateY(-3px);
        }

        /* üìå Form nh·∫≠p giao d·ªãch */
        .transaction-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        /* üìå Label */
        .input-icon label {
            font-size: 14px;
            font-weight: bold;
            color: #00ff99;
            margin-bottom: 5px;
            display: block;
        }

        /* üìå Input field */
        .form-control {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 16px;
            transition: 0.3s;
            border: 1px solid;
            height: 45px;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            outline: none;
            box-shadow: 0 0 8px #00ff99;
        }

        /* üìå N√∫t Submit */
        .btn-submit {
            background: linear-gradient(135deg, #081c12, #0f2a1b);
            color: #fff;
            font-weight: bold;
            border: none;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
            font-size: 16px;
            width: 100%;
        }

        .btn-submit:hover {
            background: linear-gradient(135deg, #0f2a1b, #00ff99);
            transform: translateY(-3px);
        }

        /* üìå Responsive */
        @media (max-width: 576px) {
            .transaction-container {
                width: 90%;
                padding: 20px;
            }
        }

        /* üìå C·∫•u tr√∫c dropdown ch√≠nh */
        select.form-control {
            appearance: none;
            background-color: #1a3323;
            /* ƒê·ªìng b·ªô m√†u n·ªÅn */
            color: #e0e0e0;
            border: 1px solid #00ff99;
            padding: 12px;
            border-radius: 8px;
            font-size: 16px;
            font-family: "Poppins", sans-serif;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease-in-out;
        }

        /* üìå Khi focus v√†o select */
        select.form-control:focus {
            outline: none;
            border-color: #00ff99;
            box-shadow: 0 0 10px rgba(0, 255, 153, 0.5);
        }

        /* üìå T√πy ch·ªânh menu dropdown */
        select.form-control option {
            background: #1a3323;
            color: #e0e0e0;
            font-size: 16px;
            padding: 10px;
        }

        /* üìå Khi hover v√†o t·ª´ng option */
        select.form-control option:hover {
            background: #00ff99;
            color: #001307;
        }

        /* üìå Khi ch·ªçn option */
        select.form-control option:checked {
            background: #00ff99;
            color: #001307;
        }

        /* üìå Dropdown icon m·∫∑c ƒë·ªãnh c·ªßa h·ªá th·ªëng (·∫©n ƒëi ƒë·ªÉ t·ª± thi·∫øt k·∫ø) */
        select.form-control::-ms-expand {
            display: none;
        }

        /* üìå T·∫°o icon dropdown custom */
        select.form-control {
            background-image: url("data:image/svg+xml;charset=UTF-8,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' width='16' height='16' fill='%2300ff99'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 16px;
            padding-right: 36px;
        }
    </style>
</head>

<body>
    <div class="container d-flex vh-100 align-items-center justify-content-center">
        <div class="transaction-container wow fadeInUp" data-wow-duration="1s">
            <h2>Th√™m Giao D·ªãch</h2>
            <p>Qu·∫£n l√Ω chi ti√™u & ti·∫øt ki·ªám c·ªßa b·∫°n m·ªôt c√°ch d·ªÖ d√†ng.</p>

            <!-- üü¢ N√∫t Back to Dashboard -->
            <div class="back-dashboard-container">
                <a href="{{ url_for('dashboard') }}" class="back-dashboard-btn">‚¨ÖÔ∏è Quay l·∫°i Trang Ch√≠nh</a>
            </div>

            <!-- Form nh·∫≠p giao d·ªãch -->
            <form method="POST" class="transaction-form">
                {{ form.hidden_tag() }}

                <p class="input-icon">
                    <label for="transaction_date">Ng√†y Giao D·ªãch</label>
                    {{ form.transaction_date(class="form-control") }}
                </p>

                <p class="input-icon">
                    <label for="transaction_type">Lo·∫°i Giao D·ªãch</label>
                    <select id="transaction_type" name="transaction_type" class="form-control" required>
                        <option value="expense">Chi Ti√™u</option>
                        <option value="income">Thu Nh·∫≠p</option>
                        <option value="saving">Ti·∫øt Ki·ªám</option>
                    </select>
                </p>

                <p class="input-icon">
                    <label for="categorySelect">Danh M·ª•c</label>
                    <select id="categorySelect" name="category_name" class="form-control" required>
                        <option value="" disabled selected>-- Ch·ªçn danh m·ª•c --</option>
                        {% for category in categories %}
                        <option value="{{ category.name }}">{{ category.name }}</option>
                        {% endfor %}
                        <option value="other">Kh√°c (Nh·∫≠p danh m·ª•c m·ªõi)</option>
                    </select>
                </p>

                <p class="input-icon">
                    <label for="transaction_amount">S·ªë Ti·ªÅn</label>
                    <i class="fas fa-money-bill-wave"></i>
                    <input type="text" name="transaction_amount" class="form-control" placeholder="Nh·∫≠p s·ªë ti·ªÅn">
                </p>


                <button type="submit" class="btn btn-submit">L∆∞u Giao D·ªãch</button>
            </form>
        </div>
    </div>

    <!-- WOW.js -->
    <script src="../static/js/wow.min.js"></script>
    <script>
        new WOW().init();
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let transactionDateInput = document.querySelector("[name=transaction_date]");

            if (transactionDateInput) {
                let today = new Date();
                let formattedDate = today.toISOString().split("T")[0]; // ƒê·ªãnh d·∫°ng YYYY-MM-DD
                transactionDateInput.value = formattedDate;
            }
        });

    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let amountInput = document.querySelector("[name=transaction_amount]");

            if (amountInput) {
                amountInput.addEventListener("input", function (event) {
                    let value = this.value.replace(/,/g, ''); // X√≥a d·∫•u ',' c≈© ƒë·ªÉ tr√°nh l·ªói nh·∫≠p
                    if (!isNaN(value) && value !== "") {
                        this.value = Number(value).toLocaleString('en-US'); // Th√™m d·∫•u ','
                    }
                });

                amountInput.addEventListener("blur", function () {
                    if (this.value === "") {
                        this.value = "0"; // ƒê·∫∑t v·ªÅ 0 n·∫øu b·ªè tr·ªëng
                    }
                });
            }
        });

    </script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            let categorySelect = document.getElementById("categorySelect");
            let newCategoryContainer = document.createElement("p");
            newCategoryContainer.id = "newCategoryContainer";
            newCategoryContainer.style.display = "block"; // M·∫∑c ƒë·ªãnh hi·ªÉn th·ªã danh m·ª•c m·ªõi
            newCategoryContainer.innerHTML = `
        <label for="newCategory">Danh M·ª•c M·ªõi</label>
        <input type="text" id="newCategory" name="new_category" class="form-control" placeholder="Nh·∫≠p danh m·ª•c m·ªõi">
    `;
            categorySelect.parentNode.insertBefore(newCategoryContainer, categorySelect.nextSibling);

            let newCategoryInput = document.getElementById("newCategory");

            // Khi ng∆∞·ªùi d√πng ch·ªçn danh m·ª•c c√≥ s·∫µn => ·∫®n √¥ nh·∫≠p danh m·ª•c m·ªõi
            categorySelect.addEventListener("change", function () {
                if (this.value !== "other") {
                    newCategoryContainer.style.display = "none"; // ·∫®n √¥ nh·∫≠p
                    newCategoryInput.value = ""; // X√≥a n·ªôi dung √¥ nh·∫≠p
                } else {
                    newCategoryContainer.style.display = "block"; // N·∫øu ch·ªçn "Kh√°c", hi·ªán l·∫°i
                }
            });

            // Khi ng∆∞·ªùi d√πng nh·∫≠p v√†o danh m·ª•c m·ªõi => T·ª± ƒë·ªông ch·ªçn "Kh√°c" trong dropdown
            newCategoryInput.addEventListener("input", function () {
                if (this.value.trim() !== "") {
                    categorySelect.value = "other"; // Chuy·ªÉn dropdown v·ªÅ "Kh√°c"
                    newCategoryContainer.style.display = "block"; // Gi·ªØ √¥ nh·∫≠p hi·ªÉn th·ªã
                }
            });
        });
    </script>
</body>

</html>