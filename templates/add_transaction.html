<form method="POST">
    {{ form.hidden_tag() }}

    <p>{{ form.transaction_date.label }} {{ form.transaction_date }}</p>

    <!-- 🟢 Chọn loại giao dịch -->
    <p>
        <label for="transaction_type">Transaction Type</label>
        <select id="transaction_type" name="transaction_type" required>
            <option value="expense">Expense</option>
            <option value="income">Income</option>
            <option value="saving">Saving</option> <!-- 🛑 Bổ sung tùy chọn Saving -->
        </select>
    </p>

    <p>
        <label for="categorySelect">Category</label>
        <select id="categorySelect" name="category_name">
            <option value="" disabled selected>-- Select a category --</option>
            {% for category in categories %}
            <option value="{{ category.name }}">{{ category.name }}</option>
            {% endfor %}
            <option value="other">Other (Enter new category)</option>
        </select>
    </p>

    <!-- 🟢 Input nhập danh mục mới (ẩn mặc định) -->
    <p id="newCategoryContainer" style="display: none;">
        <label for="newCategory">New Category</label>
        <input type="text" id="newCategory" name="new_category">
    </p>

    <p>{{ form.transaction_amount.label }} {{ form.transaction_amount }}</p>
    <p>{{ form.submit }}</p>
</form>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        let categorySelect = document.getElementById("categorySelect");
        let newCategoryContainer = document.getElementById("newCategoryContainer");
        let newCategoryInput = document.getElementById("newCategory");

        categorySelect.addEventListener("change", function () {
            if (this.value === "other") {
                newCategoryContainer.style.display = "block";
                newCategoryInput.setAttribute("required", "required");
            } else {
                newCategoryContainer.style.display = "none";
                newCategoryInput.removeAttribute("required");
            }
        });

        document.querySelector("[name=transaction_date]").setAttribute("type", "date");
    });
</script>